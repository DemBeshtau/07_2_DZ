dem@calculate ~/vagrant/07_2_DZ $ vagrant ssh

[vagrant@lvm ~]$ sudo -i

[root@lvm ~]# lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda      8:0    0  10G  0 disk 
└─sda1   8:1    0  10G  0 part /
sdb      8:16   0  10G  0 disk 

[root@lvm ~]# pvcreate --bootloaderareasize 1m /dev/sdb
  Physical volume "/dev/sdb" successfully created.

[root@lvm ~]# pvs
  PV         VG Fmt  Attr PSize  PFree 
  /dev/sdb      lvm2 ---  10.00g 10.00g

[root@lvm ~]# vgcreate vg_root /dev/sdb
  Volume group "vg_root" successfully created

[root@lvm ~]# vgs
  VG      #PV #LV #SN Attr   VSize   VFree  
  vg_root   1   0   0 wz--n- <10.00g <10.00g

[root@lvm ~]# lvcreate -n lv_root -l +100%FREE /dev/vg_root
  Logical volume "lv_root" created.

[root@lvm ~]# lvs
  LV      VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv_root vg_root -wi-a----- <10.00g                                                    

[root@lvm ~]# mkfs.xfs /dev/vg_root/lv_root 
meta-data=/dev/vg_root/lv_root   isize=512    agcount=4, agsize=655104 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1
data     =                       bsize=4096   blocks=2620416, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0

[root@lvm ~]# parted /dev/vg_root/lv_root print
Model: Linux device-mapper (linear) (dm)
Disk /dev/dm-0: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: loop
Disk Flags: 

Number  Start  End     Size    File system  Flags
 1      0.00B  10.7GB  10.7GB  xfs

[root@lvm ~]# cd /vagrant/
[root@lvm vagrant]# ll
total 1452
-rw-r--r--. 1 vagrant vagrant 1482480 Apr 19 18:54 grub2-install.el8
-rw-r--r--. 1 vagrant vagrant    2077 Apr 20 09:10 Vagrantfile

[root@lvm vagrant]# cp grub2-install.el8 /usr/sbin/

[root@lvm vagrant]# cd /usr/sbin

[root@lvm sbin]# ll | grep grub
-rwxr-xr-x. 1 root root 1188968 Sep  8  2020 grub2-bios-setup
-rwxr-xr-x. 1 root root    2398 Sep  8  2020 grubK2-get-kernel-settings
-rwxr-xr-x. 1 root root 1482424 Sep  8  2020 grub2-install
-rw-r--r--. 1 root root 1482480 Apr 20 09:24 grub2-install.el8
-rwxr-xr-x. 1 root root    8835 Sep  8  2020 grub2-mkconfig
-rwxr-xr-x. 1 root root  243744 Sep  8  2020 grub2-ofpathname
-rwxr-xr-x. 1 root root 1189112 Sep  8  2020 grub2-probe
-rwxr-xr-x. 1 root root    4085 Sep  8  2020 grub2-reboot
-rwxr-xr-x. 1 root root  281512 Sep  8  2020 grub2-rpm-sort
-rwsr-xr-x. 1 root root   12016 Sep  8  2020 grubK2-set-bootflag
-rwxr-xr-x. 1 root root    3535 Sep  8  2020 grub2-set-default
-rwxr-xr-x. 1 root root    3119 Sep  8  2020 grub2-set-password
lrwxrwxrwx. 1 root root      18 Sep  8  2020 grub2-setpassword -> grub2-set-password
-rwxr-xr-x. 1 root root 1193400 Sep  8  2020 grub2-sparc64-setup
-rwxr-xr-x. 1 root root    8694 Sep  8  2020 grub2-switch-to-blscfg
-rwxr-xr-x. 1 root root     260 May 16  2020 grubby

[root@lvm sbin]# chmod a+x grub2-install.el8 

[root@lvm sbin]# ll | grep grub
-rwxr-xr-x. 1 root root 1188968 Sep  8  2020 grub2-bios-setup
-rwxr-xr-x. 1 root root    2398 Sep  8  2020 grub2-get-kernel-settings
-rwxr-xr-x. 1 root root 1482424 Sep  8  2020 grub2-install
-rwxr-xr-x. 1 root root 1482480 Apr 20 09:24 grub2-install.el8
-rwxr-xr-x. 1 root root    8835 Sep  8  2020 grub2-mkconfig
-rwxr-xr-x. 1 root root  243744 Sep  8  2020 grub2-ofpathname
-rwxr-xr-x. 1 root root 1189112 Sep  8  2020 grub2-probe
-rwxr-xr-x. 1 root root    4085 Sep  8  2020 grub2-reboot
-rwxr-xr-x. 1 root root  281512 Sep  8  2020 grub2-rpm-sort
-rwsr-xr-x. 1 root root   12016 Sep  8  2020 grub2-set-bootflag
-rwxr-xr-x. 1 root root    3535 Sep  8  2020 grub2-set-default
-rwxr-xr-x. 1 root root    3119 Sep  8  2020 grub2-set-password
lrwxrwxrwx. 1 root root      18 Sep  8  2020 grub2-setpassword -> grub2-set-password
-rwxr-xr-x. 1 root root 1193400 Sep  8  2020 grub2-sparc64-setup
-rwxr-xr-x. 1 root root    8694 Sep  8  2020 grub2-switch-to-blscfg
-rwxr-xr-x. 1 root root     260 May 16  2020 grubby

[root@lvm ~]# mount /dev/vg_root/lv_root /mnt

[root@lvm ~]# xfsdump -J - /dev/sda1 | xfsrestore -J - /mnt
...
xfsrestore: Restore Status: SUCCESS

[root@lvm ~]# mount --bind /dev /mnt/dev
[root@lvm ~]# mount --bind /sys /mnt/sys
[root@lvm ~]# mount --bind /run /mnt/run
[root@lvm ~]# mount --bind /proc /mnt/proc
[root@lvm ~]# chroot /mnt

[root@lvm /]# cd /boot

[root@lvm boot]# ll
total 43692
-rw-r--r--. 1 root root   189500 Nov 19  2020 config-4.18.0-240.1.1.el8_3.x86_64
drwxr-xr-x. 3 root root       17 Dec  4  2020 efi
drwx------. 4 root root       83 Apr 20 09:16 grub2
-rw-------. 1 root root 30995238 Dec  4  2020 initramfs-4.18.0-240.1.1.el8_3.x86_64.img
drwxr-xr-x. 3 root root       21 Dec  4  2020 loader
-rw-------. 1 root root  4032815 Nov 19  2020 System.map-4.18.0-240.1.1.el8_3.x86_64
-rwxr-xr-x. 1 root root  9514120 Nov 19  2020 vmlinuz-4.18.0-240.1.1.el8_3.x86_64

[root@lvm boot]# mv initramfs-4.18.0-240.1.1.el8_3.x86_64.img initramfs-4.18.0-240.1.1.el8_3.x86_64.img.old

[root@lvm boot]# dracut initramfs-`uname -r`.img

[root@lvm boot]# ll
total 74196
-rw-r--r--. 1 root root   189500 Nov 19  2020 config-4.18.0-240.1.1.el8_3.x86_64
drwxr-xr-x. 3 root root       17 Dec  4  2020 efi
drwx------. 4 root root       83 Apr 20 09:16 grub2
-rw-------. 1 root root 31235234 Apr 20 09:21 initramfs-4.18.0-240.1.1.el8_3.x86_64.img
-rw-------. 1 root root 30995238 Dec  4  2020 initramfs-4.18.0-240.1.1.el8_3.x86_64.img.old
drwxr-xr-x. 3 root root       21 Dec  4  2020 loader
-rw-------. 1 root root  4032815 Nov 19  2020 System.map-4.18.0-240.1.1.el8_3.x86_64
-rwxr-xr-x. 1 root root  9514120 Nov 19  2020 vmlinuz-4.18.0-240.1.1.el8_3.x86_64

[root@lvm boot]# cd grub2/

[root@lvm grub2]# ll
total 28
-rw-r--r--. 1 root root   64 Dec  4  2020 device.map
drwxr-xr-x. 2 root root   25 Dec  4  2020 fonts
-rw-r--r--. 1 root root 6457 Dec  4  2020 grub.cfg
-rw-------. 1 root root 1024 Apr 20 09:16 grubenv
drwxr-xr-x. 2 root root 8192 Dec  4  2020 i386-pc

[root@lvm grub2]# mv grub.cfg grub.cfg.old

[root@lvm grub2]# grub2-mkconfig -o grub.cfg
Generating grub configuration file ...
device-mapper: reload ioctl on osprober-linux-sda1 (253:1) failed: Device or resource busy
Command failed.
done

[root@lvm grub2]# cat grub.cfg
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -f ${config_directory}/grubenv ]; then
  load_env -f ${config_directory}/grubenv
elif [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_output console
if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=1
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=1
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/00_tuned ###
set tuned_params=""
set tuned_initrd=""
### END /etc/grub.d/00_tuned ###

### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/08_fallback_counting ###
insmod increment
# Check if boot_counter exists and boot_success=0 to activate this behaviour.
if [ -n "${boot_counter}" -a "${boot_success}" = "0" ]; then
  # if countdown has ended, choose to boot rollback deployment,
  # i.e. default=1 on OSTree-based systems.
  if  [ "${boot_counter}" = "0" -o "${boot_counter}" = "-1" ]; then
    set default=1
    set boot_counter=-1
  # otherwise decrement boot_counter
  else
    decrement boot_counter
  fi
  save_env boot_counter
fi
### END /etc/grub.d/08_fallback_counting ###

### BEGIN /etc/grub.d/10_linux ###
insmod lvm
insmod xfs
set root='lvmid/gbJQ2o-PAry-i3Xs-n6CI-1aRG-9DqJ-WSVBDz/X9INip-KZBC-W3Ex-CMOl-Sbfd-8p8j-ltQ9Hh'
if [ x$feature_platform_search_hint = xy ]; then
  search --no-floppy --fs-uuid --set=root --hint='lvmid/gbJQ2o-PAry-i3Xs-n6CI-1aRG-9DqJ-WSVBDz/X9INip-KZBC-W3Ex-CMOl-Sbfd-8p8j-ltQ9Hh'  61f25ce7-5ca0-4de1-8d4f-4dc6e199e232
else
  search --no-floppy --fs-uuid --set=root 61f25ce7-5ca0-4de1-8d4f-4dc6e199e232
fi
insmod lvm
insmod xfs
set boot='lvmid/gbJQ2o-PAry-i3Xs-n6CI-1aRG-9DqJ-WSVBDz/X9INip-KZBC-W3Ex-CMOl-Sbfd-8p8j-ltQ9Hh'
if [ x$feature_platform_search_hint = xy ]; then
  search --no-floppy --fs-uuid --set=boot --hint='lvmid/gbJQ2o-PAry-i3Xs-n6CI-1aRG-9DqJ-WSVBDz/X9INip-KZBC-W3Ex-CMOl-Sbfd-8p8j-ltQ9Hh'  61f25ce7-5ca0-4de1-8d4f-4dc6e199e232
else
  search --no-floppy --fs-uuid --set=boot 61f25ce7-5ca0-4de1-8d4f-4dc6e199e232
fi

# This section was generated by a script. Do not modify the generated file - all changes
# will be lost the next time file is regenerated. Instead edit the BootLoaderSpec files.
#
# The blscfg command parses the BootLoaderSpec files stored in /boot/loader/entries and
# populates the boot menu. Please refer to the Boot Loader Specification documentation
# for the files format: https://www.freedesktop.org/wiki/Specifications/BootLoaderSpec/.

# The kernelopts variable should be defined in the grubenv file. But to ensure that menu
# entries populated from BootLoaderSpec files that use this variable work correctly even
# without a grubenv file, define a fallback kernelopts variable if this has not been set.
#
# The kernelopts variable in the grubenv file can be modified using the grubby tool or by
# executing the grub2-mkconfig tool. For the latter, the values of the GRUB_CMDLINE_LINUX
# and GRUB_CMDLINE_LINUX_DEFAULT options from /etc/default/grub file are used to set both
# the kernelopts variable in the grubenv file and the fallback kernelopts variable.
if [ -z "${kernelopts}" ]; then
  set kernelopts="root=/dev/mapper/vg_root-lv_root ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop "
fi

insmod blscfg
blscfg
### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/10_reset_boot_success ###
# Hiding the menu is ok if last boot was ok or if this is a first boot attempt to boot the entry
if [ "${boot_success}" = "1" -o "${boot_indeterminate}" = "1" ]; then
  set menu_hide_ok=1
else
  set menu_hide_ok=0 
fi
# Reset boot_indeterminate after a successful boot
if [ "${boot_success}" = "1" ] ; then
  set boot_indeterminate=0
# Avoid boot_indeterminate causing the menu to be hidden more then once
elif [ "${boot_indeterminate}" = "1" ]; then
  set boot_indeterminate=2
fi
# Reset boot_success for current boot 
set boot_success=0
save_env boot_success boot_indeterminate
### END /etc/grub.d/10_reset_boot_success ###

### BEGIN /etc/grub.d/12_menu_auto_hide ###
if [ x$feature_timeout_style = xy ] ; then
  if [ "${menu_show_once}" ]; then
    unset menu_show_once
    save_env menu_show_once
    set timeout_style=menu
    set timeout=60
  elif [ "${menu_auto_hide}" -a "${menu_hide_ok}" = "1" ]; then
    set orig_timeout_style=${timeout_style}
    set orig_timeout=${timeout}
    if [ "${fastboot}" = "1" ]; then
      # timeout_style=menu + timeout=0 avoids the countdown code keypress check
      set timeout_style=menu
      set timeout=0
    else
      set timeout_style=hidden
      set timeout=1
    fi
  fi
fi
### END /etc/grub.d/12_menu_auto_hide ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/30_uefi-firmware ###
### END /etc/grub.d/30_uefi-firmware ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###

[root@lvm grub2]# grub2-install.el8 /dev/sdb
Installing for i386-pc platform.
Installation finished. No error reported.

[root@lvm grub2]# exit
exit

[root@lvm ~]# reboot

dem@calculate ~/vagrant/07_2_DZ $ vagrant ssh
Last login: Sat Apr 20 09:13:54 2024 from 10.0.2.2

[vagrant@lvm ~]$ sudo -i
[root@lvm ~]# lsblk
NAME              MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda                 8:0    0  10G  0 disk 
└─sda1              8:1    0  10G  0 part 
sdb                 8:16   0  10G  0 disk 
└─vg_root-lv_root 253:0    0  10G  0 lvm  /

[root@lvm ~]# fdisk /dev/sda

Welcome to fdisk (util-linux 2.32.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Command (m for help): d
Selected partition 1
Partition 1 has been deleted.

Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

[root@lvm ~]# lsblk
NAME              MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda                 8:0    0  10G  0 disk 
sdb                 8:16   0  10G  0 disk 
└─vg_root-lv_root 253:0    0  10G  0 lvm  /

[root@lvm ~]# pvcreate --bootloaderareasize 1m /dev/sda
WARNING: dos signature detected on /dev/sda at offset 510. Wipe it? [y/n]: y
  Wiping dos signature on /dev/sda.
  Physical volume "/dev/sda" successfully created.

[root@lvm ~]# vgcreate vgr /dev/sda
  Volume group "vgr" successfully created

[root@lvm ~]# lvcreate -n lvr -l +100%FREE /dev/vgr
  Logical volume "lvr" created.

[root@lvm ~]# lvs
  LV      VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv_root vg_root -wi-ao---- <10.00g                                                    
  lvr     vgr     -wi-a----- <10.00g                                                    

[root@lvm ~]# mkfs.xfs /dev/vgr/lvr
meta-data=/dev/vgr/lvr           isize=512    agcount=4, agsize=655104 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1
data     =                       bsize=4096   blocks=2620416, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0

[root@lvm ~]# parted /dev/vgr/lvr print
Model: Linux device-mapper (linear) (dm)
Disk /dev/dm-1: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: loop
Disk Flags: 

Number  Start  End     Size    File system  Flags
 1      0.00B  10.7GB  10.7GB  xfs

[root@lvm ~]# mount /dev/vgr/lvr /mnt

[root@lvm ~]# xfsdump -J - /dev/vg_root/lv_root | xfsrestore -J - /mnt  
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.8 (dump format 3.0)
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.8 (dump format 3.0)
xfsdump: level 0 dump of lvm:/
xfsdump: dump date: Sat Apr 20 09:36:17 2024
xfsdump: session id: 51072a27-e436-4b4d-b20e-0df4afbc1df9
xfsdump: session label: ""
xfsrestore: searching media for dump
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 3501992000 bytes
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: lvm
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/vg_root-lv_root
xfsrestore: session time: Sat Apr 20 09:36:17 2024
xfsrestore: level: 0
xfsrestore: session label: ""
xfsrestore: media label: ""
xfsrestore: file system id: 61f25ce7-5ca0-4de1-8d4f-4dc6e199e232
xfsrestore: session id: 51072a27-e436-4b4d-b20e-0df4afbc1df9
xfsrestore: media id: e3506206-3c6f-4459-a804-9f2028120704
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsdump: dumping non-directory files
xfsrestore: 4028 directories and 35591 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsdump: ending media file
xfsdump: media file size 3462924248 bytes
xfsdump: dump size (non-dir files) : 3440772264 bytes
xfsdump: dump complete: 40 seconds elapsed
xfsdump: Dump Status: SUCCESS
xfsrestore: restore complete: 41 seconds elapsed
xfsrestore: Restore Status: SUCCESS

[root@lvm ~]# mount --bind /proc /mnt/proc
[root@lvm ~]# mount --bind /sys /mnt/sys
[root@lvm ~]# mount --bind /run /mnt/run
[root@lvm ~]# mount --bind /dev /mnt/dev
[root@lvm ~]# chroot /mnt
[root@lvm /]# cd /boot
[root@lvm boot]# ll
total 74196
-rw-r--r--. 1 root root   189500 Nov 19  2020 config-4.18.0-240.1.1.el8_3.x86_64
drwxr-xr-x. 3 root root       17 Dec  4  2020 efi
drwx------. 4 root root      103 Apr 20 09:30 grub2
-rw-------. 1 root root 31235234 Apr 20 09:21 initramfs-4.18.0-240.1.1.el8_3.x86_64.img
-rw-------. 1 root root 30995238 Dec  4  2020 initramfs-4.18.0-240.1.1.el8_3.x86_64.img.old
drwxr-xr-x. 3 root root       21 Dec  4  2020 loader
-rw-------. 1 root root  4032815 Nov 19  2020 System.map-4.18.0-240.1.1.el8_3.x86_64
-rwxr-xr-x. 1 root root  9514120 Nov 19  2020 vmlinuz-4.18.0-240.1.1.el8_3.x86_64

[root@lvm boot]# rm -f initramfs-4.18.0-240.1.1.el8_3.x86_64.img

[root@lvm boot]# rm -f initramfs-4.18.0-240.1.1.el8_3.x86_64.img.old 

[root@lvm boot]# dracut initramfs-`uname -r`.img

[root@lvm boot]# cd grub2/

[root@lvm grub2]# ll
total 36
-rw-r--r--. 1 root root   64 Dec  4  2020 device.map
drwxr-xr-x. 2 root root   25 Dec  4  2020 fonts
-rw-r--r--. 1 root root 6721 Apr 20 09:22 grub.cfg
-rw-r--r--. 1 root root 6457 Dec  4  2020 grub.cfg.old
-rw-------. 1 root root 1024 Apr 20 09:30 grubenv
drwxr-xr-x. 2 root root 8192 Apr 20 09:27 i386-pc

[root@lvm grub2]# rm -f grub.*

[root@lvm grub2]# ll
total 20
-rw-r--r--. 1 root root   64 Dec  4  2020 device.map
drwxr-xr-x. 2 root root   25 Dec  4  2020 fonts
-rw-------. 1 root root 1024 Apr 20 09:30 grubenv
drwxr-xr-x. 2 root root 8192 Apr 20 09:27 i386-pc

[root@lvm grub2]# grub2-mkconfig -o grub.cfg
Generating grub configuration file ...
device-mapper: reload ioctl on osprober-linux-vg_root-lv_root (253:2) failed: Device or resource busy
Command failed.
done

[root@lvm grub2]# grub2-install.el8 /dev/sda
Installing for i386-pc platform.
Installation finished. No error reported.

[root@lvm grub2]# exit
exit

[root@lvm ~]# reboot

dem@calculate ~/vagrant/07_2_DZ $ vagrant ssh
Last login: Sat Apr 20 09:28:04 2024 from 10.0.2.2

[vagrant@lvm ~]$ sudo -i

[root@lvm ~]# lsblk
NAME              MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda                 8:0    0  10G  0 disk 
└─vgr-lvr         253:1    0  10G  0 lvm  /
sdb                 8:16   0  10G  0 disk 
└─vg_root-lv_root 253:0    0  10G  0 lvm  

[root@lvm ~]# mount | grep " / "
/dev/mapper/vgr-lvr on / type xfs (ro,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)

[root@lvm ~]# mount -o remount,rw /dev/vgr/lvr

[root@lvm ~]# blkid
/dev/sda: UUID="KvQFUQ-jVe1-E2oO-0ezr-M15R-1kcD-bPqMKA" TYPE="LVM2_member" PTTYPE="PMBR"
/dev/mapper/vg_root-lv_root: UUID="61f25ce7-5ca0-4de1-8d4f-4dc6e199e232" BLOCK_SIZE="512" TYPE="xfs"
/dev/sdb: UUID="pNxO7d-4cr1-J1ed-17uq-wul4-cegY-caZJdr" TYPE="LVM2_member" PTTYPE="PMBR"
/dev/mapper/vgr-lvr: UUID="81dd91e8-738d-4fca-84c0-6c00ffc83c1a" BLOCK_SIZE="512" TYPE="xfs"

[root@lvm ~]# echo -e "`blkid | grep lvr: | awk '{print $2}'` / xfs defaults 0 0" >> /etc/fstab

[root@lvm ~]# nano /etc/fstab
...

[root@lvm ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Fri Dec  4 17:37:32 2020
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/swapfile none swap defaults 0 0
#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
#VAGRANT-END
UUID="81dd91e8-738d-4fca-84c0-6c00ffc83c1a" / xfs defaults 0 0

[root@lvm ~]# lvremove /dev/vg_root/lv_root 
Do you really want to remove active logical volume vg_root/lv_root? [y/n]: y
  Logical volume "lv_root" successfully removed.

[root@lvm ~]# vgremove /dev/vg_root
  Volume group "vg_root" successfully removed

[root@lvm ~]# pvremove /dev/sdb
  Labels on physical volume "/dev/sdb" successfully wiped.

[root@lvm ~]# lsblk
NAME      MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda         8:0    0  10G  0 disk 
└─vgr-lvr 253:1    0  10G  0 lvm  /
sdb         8:16   0  10G  0 disk 

[root@lvm ~]# reboot

dem@calculate ~/vagrant/07_2_DZ $ vagrant ssh
Last login: Sat Apr 20 11:02:30 2024 from 10.0.2.2


[vagrant@lvm ~]$ lsblk
NAME      MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda         8:0    0  10G  0 disk 
└─vgr-lvr 253:0    0  10G  0 lvm  /
sdb         8:16   0  10G  0 disk 

[vagrant@lvm ~]$ mount | grep " / "
/dev/mapper/vgr-lvr on / type xfs (rw,relatime,seclabel,attr2,inode64,logbufs=8,logbsize=32k,noquota)

[vagrant@lvm ~]$ exit
logout

dem@calculate ~/vagrant/07_2_DZ $ exit

exit

